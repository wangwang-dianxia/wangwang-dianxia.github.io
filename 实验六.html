<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8" />
    <title>ç¦å»ºåœ°å›¾å±•ç¤º - å›¾å±‚å®šä½èœå•</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="https://js.arcgis.com/4.32/esri/themes/light/main.css" />
    <script src="https://js.arcgis.com/4.32/"></script>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        }

        .header {
            height: 50px;
            background-color: #34495e;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .footer {
            height: 50px;
            background-color: #ecf0f1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        #viewDiv {
            height: calc(100% - 100px);
            width: 100%;
            position: relative;
        }

        #customSearch {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 9999;
            background: white;
            padding: 6px 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            display: flex;
            gap: 8px;
            align-items: center;
        }

        #customSearch input {
            border: none;
            outline: none;
            font-size: 14px;
            width: 180px;
        }

        #layerSelect {
            padding: 4px;
            font-size: 14px;
        }

        select {
            padding: 5px;
            font-size: 14px;
        }
    </style>
</head>
<body>
<div class="header">ç¦å»ºå†œæ—å¤§å­¦å­¦ç”Ÿæ´»åŠ¨åŠäº¤é€šå®‰å…¨ä¸“é¢˜å›¾</div>

<div id="viewDiv">
    <!-- è‡ªå®šä¹‰æœç´¢æ¡† + å›¾å±‚é€‰æ‹© -->
    <div id="customSearch">
        <input type="text" id="searchInput" placeholder="åœ¨è¿™è¾“å…¥è¿›è¡Œæœç´¢" />
        <select id="layerSelect">
            <option value="">ğŸ” é€‰æ‹©å›¾å±‚ç¼©æ”¾</option>
            <option value="traffic">äº¤é€šå®‰å…¨</option>
            <option value="area">æ´»åŠ¨åŒºåŸŸ</option>
            <option value="route">æ´»åŠ¨è·¯çº¿</option>
            <option value="point">æ´»åŠ¨ç‚¹</option>
        </select>
    </div>
</div>

<div class="footer">
    åˆ‡æ¢åº•å›¾ï¼š
    <select id="basemap-select">
        <option value="streets-navigation-vector">è¡—é“å¯¼èˆª</option>
        <option value="satellite">å«æ˜Ÿå›¾</option>
        <option value="topo-vector">åœ°å½¢å›¾</option>
        <option value="osm">OpenStreetMap</option>
        <option value="gray-vector">ç°è‰²åº•å›¾</option>
    </select>
</div>

<script>
    require([
        "esri/Map",
        "esri/views/MapView",
        "esri/layers/FeatureLayer",
        "esri/widgets/Legend",
        "esri/widgets/ScaleBar",
        "esri/widgets/LayerList"
    ], function(Map, MapView, FeatureLayer, Legend, ScaleBar, LayerList) {

        const map = new Map({
            basemap: "streets-navigation-vector"
        });

        const view = new MapView({
            container: "viewDiv",
            map: map,
            center: [119.3, 26.05],
            zoom: 12
        });

        // å›¾å±‚å®šä¹‰
        const trafficLayer = new FeatureLayer({
            url: "https://www.geosceneonline.cn/server/rest/services/Hosted/ç¦å·å¸‚ä»“å±±åŒºäº¤é€šåœ°å›¾æŸ¥çœ‹å›¾å±‚/FeatureServer/0",
            title: "äº¤é€šå®‰å…¨"
        });

        const funLayer0 = new FeatureLayer({
            url: "https://www.geosceneonline.cn/server/rest/services/Hosted/å†œå¤§å­¦ç”Ÿæ—¥å¸¸å¨±ä¹å›¾_æŸ¥çœ‹/FeatureServer/0",
            title: "å­¦ç”Ÿæ´»åŠ¨åŒºåŸŸ"
        });

        const funLayer1 = new FeatureLayer({
            url: "https://www.geosceneonline.cn/server/rest/services/Hosted/å†œå¤§å­¦ç”Ÿæ—¥å¸¸å¨±ä¹å›¾_æŸ¥çœ‹/FeatureServer/1",
            title: "å­¦ç”Ÿæ´»åŠ¨è·¯çº¿"
        });

        const funLayer2 = new FeatureLayer({
            url: "https://www.geosceneonline.cn/server/rest/services/Hosted/å†œå¤§å­¦ç”Ÿæ—¥å¸¸å¨±ä¹å›¾_æŸ¥çœ‹/FeatureServer/2",
            title: "å­¦ç”Ÿæ´»åŠ¨ç‚¹"
        });

        map.addMany([trafficLayer, funLayer0, funLayer1, funLayer2]);

        // å›¾ä¾‹
        const legend = new Legend({ view: view });
        view.ui.add(legend, "bottom-right");

        // æ¯”ä¾‹å°º
        const scaleBar = new ScaleBar({ view: view, unit: "metric" });
        view.ui.add(scaleBar, "bottom-left");

        // å›¾å±‚åˆ—è¡¨
        const layerList = new LayerList({ view: view });
        view.ui.add(layerList, "top-left");

        // å›¾å±‚ç¼©æ”¾é€»è¾‘
        const layerMap = {
            traffic: trafficLayer,
            area: funLayer0,
            route: funLayer1,
            point: funLayer2
        };

        document.getElementById("layerSelect").addEventListener("change", function (e) {
            const selected = e.target.value;
            const layer = layerMap[selected];
            if (layer) {
                layer.queryExtent().then(function(result) {
                    if (result.extent) {
                        view.goTo(result.extent.expand(1.2)); // é€‚å½“æ”¾å¤§
                    }
                });
            }
        });

        // åº•å›¾åˆ‡æ¢
        document.getElementById("basemap-select").addEventListener("change", function (e) {
            map.basemap = e.target.value;
        });

    });
</script>
</body>
</html>
